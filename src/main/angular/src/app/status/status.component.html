<div class="ui segment">
  <div *ngIf="applianceStatuses == null || applianceStatuses.length == 0" class="ui info message">
    <div class="header">{{'StatusComponent.noControllableAppliances_title' | translate}}</div>
    <p>{{'StatusComponent.noControllableAppliances_message' | translate}}</p>
  </div>
  <div class="appliances">
    <div class="appliance" *ngFor="let applianceStatus of applianceStatuses">
    <div class="traffic-light">
      <div class="bulb stopLight" *ngIf="isStopLightOn(applianceStatus)"></div>
      <div class="bulb" *ngIf="!isStopLightOn(applianceStatus)"></div>
      <!--
      <div class="bulb" *ngIf="!isStopLightOn(applianceStatus) && isGoLightOn(applianceStatus)"
           (click)="onClickStopLight(applianceStatus.id)"
           [attr.data-tooltip]="'StatusComponent.tooltipStopLight' | translate"
           data-position="right center"></div>
      -->

      <div class="bulb" [class.slowLight]="isSlowLightOn(applianceStatus)"></div>

      <div class="bulb goLight" [class.goLight-blink]="isUsingOptionalEnergy(applianceStatus)" *ngIf="isGoLightOn(applianceStatus)"></div>
      <div class="bulb" *ngIf="!isGoLightOn(applianceStatus) && applianceStatus.id === switchOnApplianceId"></div>
      <div class="bulb" *ngIf="!isGoLightOn(applianceStatus) && applianceStatus.id != switchOnApplianceId"
           (click)="onClickGoLight(applianceStatus.id)"
           [attr.data-tooltip]="'StatusComponent.tooltipGoLight' | translate"
           data-position="right center"></div>

    </div>
    <div class="appliance-details">
      <div class="appliance-type">{{getTranslatedType(applianceStatus.type)}}</div>
      <div *ngIf="!isEvCharger(applianceStatus)" class="appliance-name">{{applianceStatus.name}}</div>
      <div *ngIf="isEvCharger(applianceStatus) && applianceStatus.id != switchOnApplianceId" class="appliance-name"
      >{{getEvNameCharging(applianceStatus)}}</div>
      <div *ngIf="applianceStatus.id === switchOnApplianceId && !isEvCharger(applianceStatus)">
        <form class="ui form" [formGroup]="switchOnForm" (ngSubmit)="submitSwitchOnForm()">
          <div class="appliance-details-row">
            <span class="appliance-status-label">{{'StatusComponent.plannedRunningTime' | translate}}</span>
            <input class="appliance-number-input clockpicker" type="text" name="minRunningTime" style="width: 4em" formControlName="switchOnRunningTime">
          </div>
          <div class="appliance-details-row appliance-button-row">
            <button type="submit" class="ui button"
                    [disabled]="switchOnForm.invalid">{{'StatusComponent.buttonStart' | translate}}</button>
          </div>
        </form>
      </div>
      <div *ngIf="applianceStatus.id === switchOnApplianceId && isEvCharger(applianceStatus)">
        <form class="ui form" [formGroup]="startChargeForm" (ngSubmit)="submitStartChargeForm()">
          <div class="appliance-details-row">
              <sui-select class="selection form-control"
                        [options]="applianceStatus.evStatuses"
                        labelField="name"
                        valueField="id"
                        formControlName="electricVehicle"
                        #selectElectricVehicle
            >
              <sui-select-option *ngFor="let option of selectElectricVehicle.filteredOptions" class="dropdown-item" [value]="option"></sui-select-option>
            </sui-select>
          </div>
          <div class="appliance-details-row">
            <span class="appliance-status-label">{{'StatusComponent.stateOfCharge' | translate}}</span>
            <input type="text" class="appliance-number-input" name="stateOfCharge" style="width: 2em" formControlName="stateOfCharge">
            <span class="appliance-status-label">{{'StatusComponent.stateOfCharge2' | translate}}{{applianceStatus.stateOfCharge}} kWh</span>
          </div>
          <div class="appliance-details-row">
            <input type="text" class="appliance-number-input" name="chargeAmount" style="width: 2em" formControlName="chargeAmount">
            <span class="appliance-status-label">{{'StatusComponent.charge' | translate}}</span>
            <sui-select class="selection form-control"
                        [options]="dows"
                        labelField="name"
                        valueField="id"
                        formControlName="chargeEndDow"
                        placeholder="{{'dayOfWeek' | translate}}"
                        #selectChargeEndDow
            >
              <sui-select-option *ngFor="let option of selectChargeEndDow.filteredOptions" class="dropdown-item" [value]="option"></sui-select-option>
            </sui-select>
            <input type="text" class="appliance-number-input clockpicker" style="width: 4em" name="chargeEndTime"
                   formControlName="chargeEndTime" placeholder="00:00">
          </div>
          <div class="appliance-details-row appliance-button-row">
            <button type="submit" class="ui button"
                    [disabled]="startChargeForm.invalid">{{'StatusComponent.buttonStart' | translate}}</button>
          </div>
        </form>
      </div>
      <div *ngIf="applianceStatus.id != switchOnApplianceId && applianceStatus.planningRequested && !isEvCharger(applianceStatus)">
        <div class="appliance-status">
          <div *ngIf="isStopLightOn(applianceStatus)">
            <span class="appliance-status-label">{{'StatusComponent.earliestStart' | translate}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.earliestStart)}}</span>
          </div>
          <div *ngIf="isSlowLightOn(applianceStatus)">
            <div *ngIf="applianceStatus.interruptedSince != null">
              <span class="appliance-status-label">{{'StatusComponent.interruptedSince' | translate}}</span>
              <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.interruptedSince)}}</span>
            </div>
            <span class="appliance-status-label">{{'StatusComponent.latestStart' | translate}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.latestStart)}}</span>
          </div>
          <div *ngIf="isGoLightOn(applianceStatus)">
            <span class="appliance-status-label">{{'StatusComponent.runningTimeCompleted' | translate}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.runningTime)}}</span>
          </div>
        </div>
        <div *ngIf="applianceStatus.remainingMaxRunningTime == null">
          <div class="appliance-status">
            <span class="appliance-status-label">{{getRemainingRunningTimeLabel(applianceStatus)}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.remainingMinRunningTime)}}</span>
          </div>
        </div>
        <div *ngIf="applianceStatus.remainingMaxRunningTime != null">
          <div class="appliance-status">
            <span class="appliance-status-label">{{getRemainingMinRunningTimeLabel(applianceStatus)}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.remainingMinRunningTime)}}</span>
          </div>
          <div class="appliance-status">
            <span class="appliance-status-label">{{getRemainingMaxRunningTimeLabel(applianceStatus)}}</span>
            <span class="appliance-status-value">{{toHourMinuteWithUnits(applianceStatus.remainingMaxRunningTime)}}</span>
          </div>
        </div>
      </div>
      <div *ngIf="applianceStatus.id != switchOnApplianceId && applianceStatus.planningRequested && isEvCharger(applianceStatus)">
        <div class="appliance-status">
          <span class="appliance-status-label">{{'StatusComponent.energyPlanned' | translate}}</span>
          <span class="appliance-status-value">10 kWh</span>
        </div>
        <div class="appliance-status">
          <span class="appliance-status-label">{{'StatusComponent.energyRemaining' | translate}}</span>
          <span class="appliance-status-value">5.1 kWh</span>
        </div>
        <div class="appliance-status">
          <span class="appliance-status-label">{{'StatusComponent.energyChargePower' | translate}}</span>
          <span class="appliance-status-value">4.0 kW</span>
        </div>
        <div class="appliance-status">
          <span class="appliance-status-label">{{'StatusComponent.energyLatestEnd' | translate}}</span>
          <span class="appliance-status-value">Sonntag 18:00 Uhr</span>
        </div>
      </div>
    </div>
  </div>
  </div>
  <h4 class="ui dividing header">{{'StatusComponent.explanation' | translate}}</h4>
  <div class="traffic-light-explanation">
    <div class="traffic-light-small">
      <div class="bulb-small"></div>
      <div class="bulb-small"></div>
      <div class="bulb-small"></div>
    </div>
    <div class="traffic-light-explanation-text">
      <p>{{'StatusComponent.explanationNoLight' | translate}}</p>
    </div>
  </div>
  <div class="traffic-light-explanation">
    <div class="traffic-light-small">
      <div class="bulb-small stopLight"></div>
      <div class="bulb-small"></div>
      <div class="bulb-small"></div>
    </div>
    <div class="traffic-light-explanation-text">
      <p>{{'StatusComponent.explanationStopLight' | translate}}</p>
    </div>
  </div>
  <div class="traffic-light-explanation">
    <div class="traffic-light-small">
      <div class="bulb-small"></div>
      <div class="bulb-small slowLight"></div>
      <div class="bulb-small"></div>
    </div>
    <div class="traffic-light-explanation-text">
      <p>{{'StatusComponent.explanationSlowLight' | translate}}</p>
    </div>
  </div>
  <div class="traffic-light-explanation">
    <div class="traffic-light-small">
      <div class="bulb-small"></div>
      <div class="bulb-small"></div>
      <div class="bulb-small goLight"></div>
    </div>
    <div class="traffic-light-explanation-text">
      <p>{{'StatusComponent.explanationGoLight' | translate}}</p>
    </div>
  </div>
  <!-- pre>{{applianceStatuses | json}}</pre -->
</div>
